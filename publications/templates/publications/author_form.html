{% extends "base.html" %}

{% load i18n %}
{% load l10n %}
{% trans alert %}

{% block additional_head %}
{{ wizard.form.media }}
{% endblock %}

{% block title %}
Add new author
{% endblock %}

{% block content %}

<div class="lead">
{% blocktrans with cur_step=wizard.steps.step1 total=wizard.steps.count %}Step {{ cur_step }} of {{ total }}{% endblocktrans %}
</div>

<form class="form-horizontal" role="form" action="" method="post">{% csrf_token %}


{% if wizard.form.forms %}

    {{ wizard.form.management_form }}

    {% for form in wizard.form.forms %}

        {% for error in form.non_field_errors %}
          <div class="danger">{{ error|escape }}</div>
        {% endfor %}

<div id="input1" class="clonedInput">
        {% for field in form %}
          {% if field.errors %}
          <div class="form-group has-error">
          {% else %}
          <div class="form-group">
          {% endif %}
            <label for="{{ field.auto_id}}" class="col-sm-2 control-label">{{ field.label }}</label>
            <div class="col-sm-10">
              <input 
                 class="form-control" 
                 id="{{ field.auto_id }}" 
                 name="{{ field.html_name }}" 
                 type="{{ field.field.widget.input_type }}"
                 value="{{ field.value | default_if_none:"" }}">
              {% for error in field.errors %}
                <span class="help-block">{{ error|escape }}</span>
              {% endfor %}
            </div>
          </div>

        {% endfor %}
</div>
    {% endfor %}

{% else %}

    {{ wizard.management_form }}

    {% for error in form.non_field_errors %}
        <div class="danger">{{ error|escape }}</div>
    {% endfor %}

<div id="input1" class="clonedInput">
    {% for field in wizard.form %}

        {% if field.errors %}
        <div class="form-group has-error">
        {% else %}
        <div class="form-group">
        {% endif %}
          <label for="{{ field.auto_id}}" class="col-sm-2 control-label">{{ field.label }}</label>
          <div class="col-sm-10">
            <input 
               class="form-control" 
               id="{{ field.auto_id }}" 
               name="{{ field.html_name }}" 
               type="{{ field.field.widget.input_type }}"
               value="{{ field.value | default_if_none:"" }}">
            {% for error in field.errors %}
              <span class="help-block">{{ error|escape }}</span>
            {% endfor %}
          </div>
        </div>

    {% endfor %}
</div>
{% endif %}

<div>
  <input type="button" id="btnAdd" value="add another author" />
  <input type="button" id="btnDel" value="remove author" />
</div>

<div class="form-group">
  <div class="col-sm-offset-2 col-sm-10">

  {% if wizard.steps.prev %}
    <button class="btn btn-default" name="wizard_goto_step" type="submit" value="{{ wizard.steps.first }}">{% trans "First step" %}</button>
    <button class="btn btn-default" name="wizard_goto_step" type="submit" value="{{ wizard.steps.prev }}">{% trans "Prev step" %}</button>
  {% endif %}

    <button type="submit" class="btn btn-primary">{% trans "Next step" %}</button>
  </div>
</div>

</form>

{% endblock %}


{% block footer_scripts %}

<script>

$('#btnAdd').click(function() {
    var num        = $('.clonedInput').length;    // how many "duplicatable" input fields we currently have
    var newNum    = new Number(num + 1);        // the numeric ID of the new input field being added

    // create the new element via clone(), and manipulate it's ID using newNum value
    var newElem = $('#input' + num).clone().attr('id', 'input' + newNum);

    // manipulate the name/id values of the input inside the new element
    newElem.children(':first').attr('id', 'name' + newNum).attr('name', 'name' + newNum);

    // insert the new element after the last "duplicatable" input field
    $('#input' + num).after(newElem);

    // enable the "remove" button
    $('#btnDel').attr('disabled','');

    // business rule: you can only add 5 names
    if (newNum == 5)
        $('#btnAdd').attr('disabled','disabled');
});

$('#btnDel').click(function() {
    var num    = $('.clonedInput').length;    // how many "duplicatable" input fields we currently have
    $('#input' + num).remove();        // remove the last element

    // enable the "add" button
    $('#btnAdd').attr('disabled','');

    // if only one element remains, disable the "remove" button
    if (num-1 == 1)
        $('#btnDel').attr('disabled','disabled');
});


$('#btnDel').attr('disabled','disabled');

</script>

{% endblock %}
